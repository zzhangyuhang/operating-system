# 页面置换算法
## 功能和目标
* 功能:当缺页中断发生时,需要调入新的页面,但是内存已经满了,需要选择哪个物理页面置换
* 目标:尽可能减少缺页中断(页面换入换出)次数,即缺页中断次数,因为页面换入换出设计的是磁盘的读写,比内存读写要慢一个级别.具体来说,把未来不再使用的或短期内较少使用的页面换出,通常只能在局部性原理指导下依据过去的统计数据来进行预测.
* 页面锁定(frame locking)
	* 用于描述必须常驻内存的操作系统的关键部分或时间关键的应用程序.
	* 实现的方法是:在页表中添加锁定标志位(lock bit)
* 对进程访问页轨迹的简化

对页(虚拟地址)访问一般是给出(页号,偏移量)来进行访问的.然后我们这里只关心页号,因为页面置换算法的基本单位是页.然后对页号轨迹再次用代号进行简化.

![页的访问轨迹](https://github.com/zzhangyuhang/operating-system/blob/master/photo/5.页的访问轨迹.png)

* 实验方法
	* 模拟一个界面置换的行为并且记录产生页缺失数的量.
	* 改进算法,减少更少的缺失,获取更好的性能.

## 最优页面置换算法
### 基本思路
* 当一个缺页中断发生时,对于保存在内存当中的每一个逻辑页面,计算在它的下一次访问之前,还需要等待多长时间,从中选择等待时间最长的那个,作为被置换的页面.
* 这是一个理想的情况,在实际操作系统是无法实现的.因为操作系统并不知道未来每个页面的访问情况,以及每一个页面要等待多长时间后才会再次被访问.
* 因为算法基于未来页面的访问所以无法实现,一般用于其他置换算法的性能评价.选取一个点的时间,一段时间后,在产生了访问数据后,用最优页面置换算法进行性能评估.

### 算法过程

![最优置换算法1](https://github.com/zzhangyuhang/operating-system/blob/master/photo/5.最优置换算法1.png)

如图,最上边Time是时间序列,Requests是对应时刻下的页面访问请求.左边(page-frame)是物理内存中有的页面,Faults表示产生缺页中断,Time page needed next表示下此访问页面的时间间隔.

当我们处理前四个时刻的访问的时候,物理内存中存在对应的页面正常访问.

![最优置换算法2](https://github.com/zzhangyuhang/operating-system/blob/master/photo/5.最优置换算法2.png)

当到**5**这个时刻的时候,访问**e**页面,但是内存并没有,产生缺页中断,需要页面替换.我们找出物理内存中的四个页面距离e的最近访问的时间点.(a = 7,b = 6,c = 9,d = 10)

![最优置换算法3](https://github.com/zzhangyuhang/operating-system/blob/master/photo/5.最优置换算法3.png)

我们找到在**5**时刻未来这段时间段内最近访问时间的最远的页面**d**,替换成**e**.

![最优置换算法4](https://github.com/zzhangyuhang/operating-system/blob/master/photo/5.最优置换算法4.png)

注意,时刻**10**访问**d**的时候会产生一次缺页中断,因为物理内存中并没有响应的页面,所以需要页面置换,但是并没有未来时刻的数据,需要等到有数据之后才可以完成最优置换.




