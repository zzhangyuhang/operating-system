启动和操作系统与用户的交互
=================================
启动
===============
* 启动涉及到的组件有 BIOS bootloader和OS
* BIOS叫基本IO处理系统
* BIOS位于系统内存中,bootloader和OS位置DISK中
* BIOS的作用是找到bootloader并启动,一般bootloader位于磁盘的第一个扇区(512字节)
* bootloader的作用是在磁盘中查找到OS并启动
* 启动步骤
		
	(1) 打开电源后,进行POST加电自检,寻找显卡,然后执行内存中BIOS.
		
	(2) BIOS通过地址访问到bootloader,并把bootloader加载到内存中执行.
		
	(3) bootloader启动后查找到OS磁盘起始位置和长度,把OS加载到内存中,然后启动OS.这时计算机就把操作权交给OS

![](https://github.com/zzhangyuhang/operating-system/blob/master/photo/2.计算机启动.png)

操作系统与用户的交互
================================

操作系统与用的交互分为三种

* 中断
* 异常
* 系统调用

概念
--------------------------------------
* 中断来源于外设,是来自不同的硬件设备的计时器和网络的中断
* 异常来源于不良的应用程序,是非法指令或坏处理的状态(例如:内存出错)
* 系统调用来源于应用程序,是应用程序主动向操作系统发出服务请求

为什么要有用户和操作系统的交互
--------------------------------------
* 在计算机中,操作系统内核是信任的第三方
* 只有内核可以执行特权命令
* 方便用户对计算机所有硬件的统一管理

源头
--------------------------------------
* 中断:外设
* 异常:应用程序意向不到的指令或行为
* 系统调用:应用程序请求操作系统提供服务

处理时间
-------------------------------
* 中断:异步,用户不知道什么时候产生中断,不可预测
* 异步:同步,用户必须等待处理完异常后才能继续运行
* 系统调用:异步或者同步

响应
------------------------------
* 中断:持续的,对用户是透明的,用户感知不到
* 异常:杀死程序或者重新执行
* 系统调用:持续或者等待

注意:这里的响应跟处理有关系的,一般异步都可以继续执行,而同步则需要等待反馈.

处理过程
-------------------------------------
* 中断
	* 硬件设立中断标记,产生中断ID
	* 软件保存当前状态,中断服务程序处理
	* 消除中断状态
	* 恢复之前保存的处理状态
* 异常
	* 保存现场
	* 异常处理:(1)kill (2)restart
	* 恢复现场

注意:中断和异常都是先要保存之前的状态,然后需要内核做出处理.处理完后,中断直接恢复之前的状态,而异常可以重新执行当前出错命令.

系统调用和程序调用
-----------------------------------
* 系统调用,是程序应用通过操作系统提供的API来请求服务的
* 程序调用,是程序应用调用程序的API来完成功能
	* WIN32 API用于windows,是系统调用
	* POSIX API用于POSIX-BASED SYSTEM(UNIX,LINUX,MAC OS),是系统调用
	* JAVA API用于JVM,是程序调用
* 区别
	* 系统调用:涉及状态转换,用户态到内核态,执行时间长
	* 程序调用:不涉及状态转换,只是用户态,执行时间短

状态交互的开销
----------------------------------
* 建立索引表,建立中断/异常/系统调用号与服务带来的开销
* 通过索引表验证请求参数开销
* 数据拷贝开销,用户堆栈 -> 内核堆栈 -> 用户堆栈
* 维护索引表和内核堆栈的开销
* 可能带来内核页面置换

这些开销都是值得的,为了保证操作系统安全可靠的环境中执行.